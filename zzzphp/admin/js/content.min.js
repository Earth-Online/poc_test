function $childNode(o){return window.frames[o]}function animationHover(o,e){o=$(o),o.hover(function(){o.addClass("animated "+e)},function(){window.setTimeout(function(){o.removeClass("animated "+e)},2e3)})}function WinMove(){var o="[class*=col]",e=".ibox-title",i="[class*=col]";$(o).sortable({handle:e,connectWith:i,tolerance:"pointer",forcePlaceholderSize:!0,opacity:.8}).disableSelection()}var $parentNode=window.parent.document;if($(".tooltip-demo").tooltip({selector:"[data-toggle=tooltip]",container:"body"}),$(".modal").appendTo("body"),$("[data-toggle=popover]").popover(),$(".collapse-link").click(function(){var o=$(this).closest("div.ibox"),e=$(this).find("i"),i=o.find("div.ibox-content");i.slideToggle(200),e.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),o.toggleClass("").toggleClass("border-bottom"),setTimeout(function(){o.resize(),o.find("[id^=map-]").resize()},50)}),$(".close-link").click(function(){var o=$(this).closest("div.ibox");o.remove()}),top==this);
var pytitle=$("#pytitle");
parent.$(".layui-layer-title")[0].innerText = $(document).attr("title");
if($("#content").length>0){
	var $ZZZEditor =new UE.getEditor('content','');
	$('#contentform').submit(function () {if($ZZZEditor.queryCommandState('source')==1) $ZZZEditor.execCommand('source'); });
}
if($("#addtime").length>0){
 $("#addtime").jeDate({isinitVal:true});
 }
function getContentTxt(){$("#pagedesc").val($ZZZEditor.getContentTxt());}
$("#getpinyin").click(function(){$.post("function.php?act=pinyin",{"sort":$("#title").val()},function(result){pytitle.val(result.substring(0,30));pytitle.focus();});});pytitle.blur(function(){var thisval=$(this).val();var oldvalue=$(this).attr("oldvalue");var regular=/^([^\`\+\~\!\#\$\%\^\&\*\(\)\|\}\{\=\"\'\！\￥\……\（\）\——]*[\+\~\!\#\$\%\^\&\*\(\)\|\}\{\=\"\'\`\！\?\:\<\>\•\“\”\；\‘\‘\〈\ 〉\￥\……\（\）\——\｛\｝\【\】\\\/\;\：\？\《\》\。\，\、\[\]\,]+.*)$/;if(thisval==""){$("#addpage").show();}else if(regular.test(thisval)){alert("此网址名称不能含有符号，可以使用-_");pytitle.focus();}});
function getKeys(){var title=$('#title').val().replace(/[&\|\\\,.;，。？！、*^%$#@\-]/g,''),length=title.length,keys='';if(length>4){for(var i=0;i<length;i++){if(i>2&&i%2!=0){keys+=title[i-3]+title[i-2]+title[i-1]+title[i]+'|'}}}else{keys=title};$('#c_pagekey').val(keys);}
function getimgs(file,data){
if (data.state=="SUCCESS")
	{
		$( '#'+file.id ).find("img").attr("src",data.url);
		$( '#'+file.id ).append("<div class='file-panel'><i class='cancel'>删除</i><i class='moveRight'>向右</i><i class='moveLeft'>向左</i></div>")	
		$( '#'+file.id ).append("<input value="+data.url+" name=picsurl[]>")	
		$( '#'+file.id ).append("<input value="+data.title+" name=picsname[]>")		
		$( '#'+file.id ).find("span").addClass('success')
		if ($("#indexpic").val()==""){
			$("#indexpic").val(data.url);	
			$("#indeximg").attr("src",data.url);	
			$( '#'+file.id ).find("span").addClass('selected')
		}
	}else{
		$( '#'+file.id ).append("<div class='file-panel'><i class='cancel'>删除</i></div>")	
		$( '#'+file.id ).append("<p class='error'>"+data.url+"</p>")	
	}
}
function openimagemanager(folder){layer.open({type: 2, area: ['630px', '450px'], content:"?module=imagelist&upfolder="+folder})}
function openfilemanager(folder){layer.open({type: 2, area: ['780px', '450px'], content:"?module=filelist&upfolder="+folder})}
$("#indexpic").change(function() {   $("#indeximg").attr("src", $(this).val());});
$(function(){
	 if ($(".chosen-select").length > 0){ 
		$(".chosen-select").chosen({placeholder_text_multiple: "请选择"}); 
	 }
	$('textarea').each(function() {
		$value= this.value;
		$height = this.scrollHeight;
		if ($height == 0) {			
		  $height=$value.length >0 ? $value.length : 80;	
		}
		if ($height > 200)  $height=200;
		if ($height < 80) $height=80;
		this.setAttribute('style', 'height:' + ($height) + 'px;');
	}).on('input', function() {
			this.setAttribute('style', 'height:'+this.scrollHeight+'px;overflow-y:hidden;');
	})
  $(".filelist").on('mouseenter', "li", function() {
	  $(this).find(".file-panel").stop().animate({
		  height: 30
	  });
  });
  $(".filelist").on('mouseleave', "li", function() {
	  $(this).find(".file-panel").stop().animate({
		  height: 0
	  });
  });
  $(".filelist").on('click', 'i', function() {
    var index = $(this).index();
	 switch (index) {
        case 0:
            $(this).parent().parent("li").remove();
			 return;
        case 1:
            $(this).parent().parent().before($(this).parent().parent().next());
            break;
        case 2:
            $(this).parent().parent().after($(this).parent().parent().prev());
            break;
    }
 });
 $(".filelist").on("click", "span", function() {
    $(".filelist").find("span").removeClass("selected")
    $(this).addClass("selected");
	val = $(this).parent().find("input[name='picsurl[]']").val();
    $("#indexpic").val(val);
    $("#indeximg").attr("src", val);　
 });

 $("#file_tbody").on('click', 'i', function() {
    var $class = $(this).attr("class");
	 switch ($class) {
        case 'fa fa-remove':
            $(this).parent().parent("tr").remove();
			 return;
		case 'fa fa-plus':	 
			$(this).parent().html("<i class='fa fa-arrow-up'></i> <i class='fa fa-arrow-down'></i> <i class='fa fa-remove'></i>")
			$("#file_tbody").append("<tr class='fileli'><td></td><td><input name='c_downname[]' class='form-control input-sm' value='' placeholder='附件名称'></td> "
			                       +"<td><input name='c_downurl[]' class='form-control input-sm' value='' placeholder='下载地址'></td>"
								   +"<td><i class='fa fa-plus'></i> <i class='fa fa-remove'></i></td></tr>");
	
        case 'fa fa-arrow-down':
            $(this).parent().parent().before($(this).parent().parent().next());
            break;
        case 'fa fa-arrow-up':
            $(this).parent().parent().after($(this).parent().parent().prev());
            break;
    }
 });
});
 $("#color").colorpicker().on('changeColor', function(e) {
	$('#title').attr("style","color:"+e.color.toHex());
 }); 

$("#select_tag").click(function() {
    if ($("#taglist a").length == 0) {
        tagval = $("#tag").val();
        $.post("function.php?act=gettag", function(result) {
            var json = eval(result);
            $.each(json, function(i, item) {
              if(tagval.indexOf(json[i].t_name)>=0){$selected="selected";}else{$selected="";}
                $("#taglist").append("<a class='btn btn-link addtag "+$selected+"'>" + json[i].t_name + "</a>");
            });
        }, 'json')
    }
});

//$("#systag a").each(function(){if(tagval.indexOf($(this).text())>=0){$(this).addClass("selected");}});
$("#taglist").on("click",".addtag",function(){tagval=$("#tag").val();tagtext=$(this).text();if($(this).hasClass("selected"))
{$(this).removeClass("selected");val=tagval.replace(tagtext,"").replace(",,",",");}
else
{$(this).addClass("selected");val=tagval+","+tagtext;}
if(val.substr(0,1)==',')val=val.substr(1);val=val.replace(/,$/gi,"");$("#tag").val(val);})
